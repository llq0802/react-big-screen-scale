{"version":3,"file":"react-big-screen-scale.esm.js","sources":["../src/components/BigScreenScale.tsx"],"sourcesContent":["import React, { CSSProperties, FC, useEffect, useRef } from 'react';\r\nimport { BigScreenScaleType } from './types.d';\r\n// import './BigScreenScale.less';\r\n\r\ninterface IState {\r\n  originalWidth: string | number;\r\n  originalHeight: string | number;\r\n  width?: string | number;\r\n  height?: string | number;\r\n}\r\n\r\n/**\r\n * 防抖函数\r\n * @param {T} fn\r\n * @param {number} delay\r\n * @returns {() => void}\r\n */\r\nfunction debounce<T = Function>(fn: T, delay: number = 400): () => void {\r\n  let timer: NodeJS.Timeout;\r\n  return function(...args: any[]): void {\r\n    if (timer) clearTimeout(timer);\r\n    timer = setTimeout(\r\n      () => {\r\n        typeof fn === 'function' && fn.apply(null, args);\r\n        clearTimeout(timer);\r\n      },\r\n      delay > 0 ? delay : 100\r\n    );\r\n  };\r\n}\r\n\r\n/**\r\n *\r\n * 缩放组件\r\n * @param {*} props\r\n * @return {*}\r\n */\r\nconst BigScreenScale: FC<Partial<BigScreenScaleType>> = props => {\r\n  const {\r\n    width = 1920,\r\n    height = 1080,\r\n    autoScale = true,\r\n    isfullScreen = false,\r\n    containerStyle,\r\n    wrapperStyle,\r\n    children,\r\n  } = props;\r\n\r\n  const screenWrapper = useRef<HTMLDivElement>(null);\r\n  const state = useRef<IState>({\r\n    width: 0,\r\n    height: 0,\r\n    originalWidth: 0,\r\n    originalHeight: 0,\r\n  });\r\n\r\n  const styles: Record<string, CSSProperties> = {\r\n    container: {\r\n      overflow: 'hidden',\r\n      backgroundSize: `100% 100%`,\r\n      width: `100vw`,\r\n      height: `100vh`,\r\n      // background: `#000`,\r\n    },\r\n    wrapper: {\r\n      transitionProperty: `all`,\r\n      transitionTimingFunction: `cubic-bezier(0.4, 0, 0.2, 1)`,\r\n      transitionDuration: `500ms`,\r\n      position: `relative`,\r\n      overflow: `hidden`,\r\n      zIndex: 100,\r\n      transformOrigin: `left top`,\r\n      // transformOrigin: `center center`,\r\n    },\r\n  };\r\n\r\n  const onResize = debounce(() => {\r\n    initSize();\r\n    updateSize();\r\n    updateScale();\r\n  });\r\n\r\n  /**\r\n   * 初始化大屏容器宽高\r\n   */\r\n  const initSize = () => {\r\n    // region 获取大屏真实尺寸\r\n    if (width && height) {\r\n      state.current.width = width;\r\n      state.current.height = height;\r\n    } else {\r\n      state.current.width = screenWrapper.current?.clientWidth;\r\n      state.current.height = screenWrapper.current?.clientHeight;\r\n    }\r\n    // region 获取画布尺寸\r\n    if (!state.current.originalHeight || !state.current.originalWidth) {\r\n      state.current.originalWidth = window.screen.width;\r\n      state.current.originalHeight = window.screen.height;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 更新大屏容器宽高\r\n   */\r\n  const updateSize = () => {\r\n    if (state.current.width && state.current.height) {\r\n      screenWrapper.current!.style.width = `${state.current.width}px`;\r\n      screenWrapper.current!.style.height = `${state.current.height}px`;\r\n    } else {\r\n      screenWrapper.current!.style.width = `${state.current.originalWidth}px`;\r\n      screenWrapper.current!.style.height = `${state.current.originalHeight}px`;\r\n    }\r\n  };\r\n\r\n  const setDomScale = (scale: number) => {\r\n    if (!autoScale) return;\r\n    const domWidth = screenWrapper.current!.clientWidth;\r\n    const domHeight = screenWrapper.current!.clientHeight;\r\n    const bodyWidth = document.body.clientWidth;\r\n    const bodyHeight = document.body.clientHeight;\r\n    screenWrapper.current!.style.transform = `scale(${scale},${scale})`;\r\n    // 计算外边距\r\n    let mx = Math.max((bodyWidth - domWidth * scale) / 2, 0);\r\n    let my = Math.max((bodyHeight - domHeight * scale) / 2, 0);\r\n    // 若手动控制外边距\r\n    if (typeof autoScale === 'object') {\r\n      !((autoScale as unknown) as { x: boolean; y: boolean }).x && (mx = 0);\r\n      !((autoScale as unknown) as { x: boolean; y: boolean }).y && (my = 0);\r\n    }\r\n    screenWrapper.current!.style.margin = `${my}px ${mx}px`;\r\n  };\r\n\r\n  const updateScale = () => {\r\n    // 获取真实视口尺寸\r\n    const bodyWidth = document.body.clientWidth;\r\n    const bodyHeight = document.body.clientHeight;\r\n    // 获取大屏最终的宽高\r\n    const realWidth = state.current.width || state.current.originalWidth;\r\n    const realHeight = state.current.height || state.current.originalHeight;\r\n    // 计算缩放比例\r\n    const widthScale = bodyWidth / +realWidth;\r\n    const heightScale = bodyHeight / +realHeight;\r\n    // 若要铺满全屏，则按照各自比例缩放\r\n    if (isfullScreen) {\r\n      screenWrapper.current!.style.transform = `scale(${widthScale},${heightScale})`;\r\n    } else {\r\n      // 按照宽高最小比例进行缩放\r\n      const scale = Math.min(widthScale, heightScale);\r\n      setDomScale(scale);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    initSize();\r\n    updateSize();\r\n    updateScale();\r\n    window.addEventListener('resize', onResize);\r\n    return () => {\r\n      window.removeEventListener('resize', onResize);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <section\r\n      className=\"react-big-screen-scale\"\r\n      style={{ ...styles.container, ...containerStyle }}\r\n    >\r\n      <div ref={screenWrapper} style={{ ...styles.wrapper, ...wrapperStyle }}>\r\n        {children ?? '请传入被要包裹的组件'}\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default BigScreenScale;\r\n"],"names":["debounce","fn","delay","timer","args","clearTimeout","setTimeout","apply","BigScreenScale","props","width","height","autoScale","isfullScreen","containerStyle","wrapperStyle","children","screenWrapper","useRef","state","originalWidth","originalHeight","styles","container","overflow","backgroundSize","wrapper","transitionProperty","transitionTimingFunction","transitionDuration","position","zIndex","transformOrigin","onResize","initSize","updateSize","updateScale","current","clientWidth","clientHeight","window","screen","style","setDomScale","scale","domWidth","domHeight","bodyWidth","document","body","bodyHeight","transform","mx","Math","max","my","x","y","margin","realWidth","realHeight","widthScale","heightScale","min","useEffect","addEventListener","removeEventListener","React","className","ref"],"mappings":"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"}